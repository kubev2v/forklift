---
# MTV Hook CR for installing monitoring after migration
#
# Apply this to your cluster:
#   kubectl apply -f hook-cr.yaml
#
# Then reference it in your migration Plan:
#   spec:
#     vms:
#       - id: vm-123
#         hooks:
#           - hook:
#               namespace: konveyor-forklift
#               name: install-monitoring
#             step: PostHook
#
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: install-monitoring
  namespace: konveyor-forklift
spec:
  # The hook-runner image contains Ansible and kubectl
  image: quay.io/konveyor/hook-runner:latest
  
  # Base64 encoded playbook (see playbook.yml)
  # To regenerate: ../scripts/encode-playbook.sh playbook.yml
  playbook: LS0tCiMgUG9zdEhvb2s6IEluc3RhbGwgbm9kZV9leHBvcnRlciBtb25pdG9yaW5nIGFmdGVyIG1pZ3JhdGlvbiBjb21wbGV0ZXMKI1RoaXMgc2V0cyB1cCBQcm9tZXRoZXVzLWNvbXBhdGlibGUgbW9uaXRvcmluZyBvbiB0aGUgbWlncmF0ZWQgVk0KCi0gbmFtZTogUG9zdEhvb2sgLSBTZXR1cCBTU0ggYW5kIGxvYWQgTVRWIG1ldGFkYXRhCiAgaG9zdHM6IGxvY2FsaG9zdAogIGdhdGhlcl9mYWN0czogeWVzCiAgdGFza3M6CiAgICAtIG5hbWU6IExvYWQgbWlncmF0aW9uIFBsYW4gbWV0YWRhdGEKICAgICAgaW5jbHVkZV92YXJzOgogICAgICAgIGZpbGU6IHBsYW4ueW1sCiAgICAgICAgbmFtZTogcGxhbgoKICAgIC0gbmFtZTogTG9hZCBWTSB3b3JrbG9hZCBtZXRhZGF0YQogICAgICBpbmNsdWRlX3ZhcnM6CiAgICAgICAgZmlsZTogd29ya2xvYWQueW1sCiAgICAgICAgbmFtZTogd29ya2xvYWQKCiAgICAtIG5hbWU6IEdldCBjdXJyZW50IHVzZXIgaW5mbyBmb3IgU1NIIHNldHVwCiAgICAgIGdldGVudDoKICAgICAgICBkYXRhYmFzZTogcGFzc3dkCiAgICAgICAga2V5OiAie3sgYW5zaWJsZV91c2VyX2lkIH19IgogICAgICAgIHNwbGl0OiAnOicKCiAgICAtIG5hbWU6IEVuc3VyZSBTU0ggZGlyZWN0b3J5IGV4aXN0cwogICAgICBmaWxlOgogICAgICAgIHBhdGg6IH4vLnNzaAogICAgICAgIHN0YXRlOiBkaXJlY3RvcnkKICAgICAgICBtb2RlOiAwNzUwCiAgICAgIGVudmlyb25tZW50OgogICAgICAgIEhPTUU6ICJ7eyBhbnNpYmxlX2ZhY3RzLmdldGVudF9wYXNzd2RbYW5zaWJsZV91c2VyX2lkXVs0XSB9fSIKCiAgICAtIG5hbWU6IFJldHJpZXZlIFNTSCBjcmVkZW50aWFscyBmcm9tIEt1YmVybmV0ZXMgU2VjcmV0CiAgICAgIGs4c19pbmZvOgogICAgICAgIGFwaV92ZXJzaW9uOiB2MQogICAgICAgIGtpbmQ6IFNlY3JldAogICAgICAgIG5hbWU6IHZtLXNzaC1jcmVkZW50aWFscwogICAgICAgIG5hbWVzcGFjZToga29udmV5b3ItZm9ya2xpZnQKICAgICAgcmVnaXN0ZXI6IHNzaF9jcmVkZW50aWFscwoKICAgIC0gbmFtZTogQ3JlYXRlIFNTSCBwcml2YXRlIGtleSBmaWxlCiAgICAgIGNvcHk6CiAgICAgICAgZGVzdDogfi8uc3NoL210dl9taWdyYXRpb25fa2V5CiAgICAgICAgY29udGVudDogInt7IHNzaF9jcmVkZW50aWFscy5yZXNvdXJjZXNbMF0uZGF0YS5rZXkgfCBiNjRkZWNvZGUgfX0iCiAgICAgICAgbW9kZTogMDYwMAoKICAgIC0gbmFtZTogQWRkIHRhcmdldCBWTSB0byBBbnNpYmxlIGludmVudG9yeQogICAgICBhZGRfaG9zdDoKICAgICAgICBuYW1lOiAie3sgd29ya2xvYWQudm0uaXBhZGRyZXNzIH19IgogICAgICAgIGFuc2libGVfdXNlcjogcm9vdAogICAgICAgIGFuc2libGVfc3NoX3ByaXZhdGVfa2V5X2ZpbGU6IH4vLnNzaC9tdHZfbWlncmF0aW9uX2tleQogICAgICAgIGFuc2libGVfc3NoX2NvbW1vbl9hcmdzOiAnLW8gU3RyaWN0SG9zdEtleUNoZWNraW5nPW5vJwogICAgICAgIGdyb3VwczogdGFyZ2V0X3ZtcwoKLSBuYW1lOiBJbnN0YWxsIG1vbml0b3Jpbmcgb24gdGFyZ2V0IFZNCiAgaG9zdHM6IHRhcmdldF92bXMKICBnYXRoZXJfZmFjdHM6IHllcwogIHZhcnM6CiAgICBub2RlX2V4cG9ydGVyX3ZlcnNpb246ICIxLjcuMCIKICAgIG5vZGVfZXhwb3J0ZXJfcG9ydDogOTEwMAogIHRhc2tzOgogICAgLSBuYW1lOiBDcmVhdGUgbm9kZV9leHBvcnRlciB1c2VyCiAgICAgIHVzZXI6CiAgICAgICAgbmFtZTogbm9kZV9leHBvcnRlcgogICAgICAgIHNoZWxsOiAvc2Jpbi9ub2xvZ2luCiAgICAgICAgc3lzdGVtOiB5ZXMKY3JlYXRlX2hvbWU6IG5vCgogICAgLSBuYW1lOiBEb3dubG9hZCBub2RlX2V4cG9ydGVyCiAgICAgIGdldF91cmw6CiAgICAgICAgdXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL3Byb21ldGhldXMvbm9kZV9leHBvcnRlci9yZWxlYXNlcy9kb3dubG9hZC92e3sgbm9kZV9leHBvcnRlcl92ZXJzaW9uIH19L25vZGVfZXhwb3J0ZXIte3sgbm9kZV9leHBvcnRlcl92ZXJzaW9uIH19LmxpbnV4LWFtZDY0LnRhci5neiIKICAgICAgICBkZXN0OiAvdG1wL25vZGVfZXhwb3J0ZXIudGFyLmd6CiAgICAgICAgbW9kZTogMDY0NAoKICAgIC0gbmFtZTogRXh0cmFjdCBub2RlX2V4cG9ydGVyCiAgICAgIHVuYXJjaGl2ZToKICAgICAgICBzcmM6IC90bXAvbm9kZV9leHBvcnRlci50YXIuZ3oKICAgICAgICBkZXN0OiAvdG1wLwogICAgICAgIHJlbW90ZV9zcmM6IHllcwoKICAgIC0gbmFtZTogSW5zdGFsbCBub2RlX2V4cG9ydGVyIGJpbmFyeQogICAgICBjb3B5OgogICAgICAgIHNyYzogIi90bXAvbm9kZV9leHBvcnRlci17eyBub2RlX2V4cG9ydGVyX3ZlcnNpb24gfX0ubGludXgtYW1kNjQvbm9kZV9leHBvcnRlciIKICAgICAgICBkZXN0OiAvdXNyL2xvY2FsL2Jpbi9ub2RlX2V4cG9ydGVyCiAgICAgICAgb3duZXI6IG5vZGVfZXhwb3J0ZXIKICAgICAgICBncm91cDogbm9kZV9leHBvcnRlcgogICAgICAgIG1vZGU6IDA3NTUKICAgICAgICByZW1vdGVfc3JjOiB5ZXMKCiAgICAtIG5hbWU6IENyZWF0ZSBub2RlX2V4cG9ydGVyIHN5c3RlbWQgc2VydmljZQogICAgICBjb3B5OgogICAgICAgIGRlc3Q6IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbm9kZV9leHBvcnRlci5zZXJ2aWNlCiAgICAgICAgY29udGVudDogfAogICAgICAgICAgW1VuaXRdCiAgICAgICAgICBEZXNjcmlwdGlvbj1Ob2RlIEV4cG9ydGVyCiAgICAgICAgICBEb2N1bWVudGF0aW9uPWh0dHBzOi8vcHJvbWV0aGV1cy5pby9kb2NzL2d1aWRlcy9ub2RlLWV4cG9ydGVyLwogICAgICAgICAgQWZ0ZXI9bmV0d29yay1vbmxpbmUudGFyZ2V0CiAgICAgICAgICAKICAgICAgICAgIFtTZXJ2aWNlXQogICAgICAgICAgVHlwZT1zaW1wbGUKICAgICAgICAgIFVzZXI9bm9kZV9leHBvcnRlcgogICAgICAgICAgR3JvdXA9bm9kZV9leHBvcnRlcgogICAgICAgICAgRXhlY1N0YXJ0PS91c3IvbG9jYWwvYmluL25vZGVfZXhwb3J0ZXIgXAogICAgICAgICAgICAtLXdlYi5saXN0ZW4tYWRkcmVzcz06e3sgbm9kZV9leHBvcnRlcl9wb3J0IH19CiAgICAgICAgICAKICAgICAgICAgIFN5c2xvZ0lkZW50aWZpZXI9bm9kZV9leHBvcnRlcgogICAgICAgICAgUmVzdGFydD1hbHdheXMKICAgICAgICAgIFJlc3RhcnRTZWM9NQogICAgICAgICAgCiAgICAgICAgICBbSW5zdGFsbF0KICAgICAgICAgIFdhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0CiAgICAgICAgbW9kZTogMDY0NAoKICAgIC0gbmFtZTogUmVsb2FkIHN5c3RlbWQgZGFlbW9uCiAgICAgIHN5c3RlbWQ6CiAgICAgICAgZGFlbW9uX3JlbG9hZDogeWVzCgogICAgLSBuYW1lOiBFbmFibGUgYW5kIHN0YXJ0IG5vZGVfZXhwb3J0ZXIKICAgICAgc3lzdGVtZDoKICAgICAgICBuYW1lOiBub2RlX2V4cG9ydGVyCiAgICAgICAgc3RhdGU6IHN0YXJ0ZWQKICAgICAgICBlbmFibGVkOiB5ZXMKCiAgICAtIG5hbWU6IE9wZW4gZmlyZXdhbGwgcG9ydCBmb3Igbm9kZV9leHBvcnRlciAoZmlyZXdhbGxkKQogICAgICBmaXJld2FsbGQ6CiAgICAgICAgcG9ydDogInt7IG5vZGVfZXhwb3J0ZXJfcG9ydCB9fS90Y3AiCiAgICAgICAgcGVybWFuZW50OiB5ZXMKICAgICAgICBzdGF0ZTogZW5hYmxlZAogICAgICAgIGltbWVkaWF0ZTogeWVzCiAgICAgIHdoZW46IGFuc2libGVfZmFjdHMuc2VydmljZXNbJ2ZpcmV3YWxsZC5zZXJ2aWNlJ10gaXMgZGVmaW5lZAogICAgICBpZ25vcmVfZXJyb3JzOiB5ZXMKCiAgICAtIG5hbWU6IE9wZW4gZmlyZXdhbGwgcG9ydCBmb3Igbm9kZV9leHBvcnRlciAodWZ3KQogICAgICB1Znc6CiAgICAgICAgcnVsZTogYWxsb3cKICAgICAgICBwb3J0OiAie3sgbm9kZV9leHBvcnRlcl9wb3J0IH19IgogICAgICAgIHByb3RvOiB0Y3AKICAgICAgd2hlbjogYW5zaWJsZV9mYWN0cy5zZXJ2aWNlc1sndWZ3LnNlcnZpY2UnXSBpcyBkZWZpbmVkCiAgICAgIGlnbm9yZV9lcnJvcnM6IHllcwoKICAgIC0gbmFtZTogVmVyaWZ5IG5vZGVfZXhwb3J0ZXIgaXMgcnVubmluZwogICAgICB1cmk6CiAgICAgICAgdXJsOiAiaHR0cDovL2xvY2FsaG9zdDp7eyBub2RlX2V4cG9ydGVyX3BvcnQgfX0vbWV0cmljcyIKICAgICAgICBtZXRob2Q6IEdFVAogICAgICAgIHN0YXR1c19jb2RlOiAyMDAKICAgICAgcmVnaXN0ZXI6IG1ldHJpY3NfY2hlY2sKICAgICAgcmV0cmllczogMwogICAgICBkZWxheTogNQogICAgICB1bnRpbDogbWV0cmljc19jaGVjay5zdGF0dXMgPT0gMjAwCgogICAgLSBuYW1lOiBMb2cgY29tcGxldGlvbgogICAgICBkZWJ1ZzoKICAgICAgICBtc2c6ICJub2RlX2V4cG9ydGVyIG1vbml0b3JpbmcgaW5zdGFsbGVkIHN1Y2Nlc3NmdWxseSBvbiB7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX06e3sgbm9kZV9leHBvcnRlcl9wb3J0IH19Igo=
  
  # ServiceAccount with permissions to read secrets
  serviceAccount: forklift-controller
  
  # Hook timeout in seconds (default: 600)
  deadline: 1800

